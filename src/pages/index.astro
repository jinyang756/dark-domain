---
// æš—åŸŸé¦–é¡µ V4.0 - â€œå£°éŸ³ä¸ç”Ÿå‘½â€
import '../styles/global.css';

const doorways = [
  { name: 'å¤©é“', href: '/core-theory', description: 'å®‡å®™è§‚ã€ç‚ã€å› æœè®º' },
  { name: 'åœ°é“', href: '/case-studies', description: 'ç°å®è§„å¾‹ã€ä»·å€¼æŠ•èµ„' },
  { name: 'äººé“', href: '/handbook', description: 'å†…å¿ƒä¿®ç‚¼ã€è‡ªæˆ‘ä¹‹è¾¨' },
];
---
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>æš—åŸŸ Â· Athen Drakmvese</title>
  <!-- æ­¥éª¤ä¸€ï¼šå¼•å…¥Tone.jséŸ³é¢‘åº“ -->
  <script is:inline src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.7.77/Tone.js"></script>
</head>
<body>
  <div class="scene-container">
    <!-- ... (æ‚¨å·²æœ‰çš„åœºæ™¯HTMLä»£ç ä¿æŒä¸å˜) ... -->
    <div class="night-sky">
      <div class="moon"></div>
      <div class="stars"></div>
      <div class="nebula"></div>
    </div>
    <div class="doorway">
      <div class="door-frame">
        <div class="door-interactions">
          {doorways.map(door => (
            <a href={door.href} class="interaction-point interactive-link" title={door.description}>{door.name}</a>
          ))}
        </div>
      </div>
      <div class="door">
        <a href="/trailer" class="main-rune interactive-link" title="è§‚çœ‹ã€Šç†µå‡æ—¶é’Ÿã€‹é¢„å‘Šç‰‡">â—†</a>
      </div>
    </div>
    <div class="scholar-silhouette"></div>
    <div class="ground"></div>

    <!-- æ­¥éª¤äºŒï¼šæ·»åŠ å£°éŸ³æ§åˆ¶æŒ‰é’® -->
    <div id="sound-toggle" class="sound-control" title="å¼€å¯å£°éŸ³">
      ğŸ”‡
    </div>
    
    <footer class="site-footer">
      Athen Drakmvese
    </footer>
  </div>
</body>
</html>

<!-- æ­¥éª¤ä¸‰ï¼šæ·»åŠ å…¨æ–°çš„JavaScripté€»è¾‘ -->
<script>
  document.addEventListener('DOMContentLoaded', () => {
    // è·å–æ‰€æœ‰å¯äº¤äº’çš„é“¾æ¥
    const interactiveLinks = document.querySelectorAll('.interactive-link');
    const soundToggle = document.getElementById('sound-toggle');

    let isAudioReady = false;
    let isMuted = true;

    // åˆ›å»ºäº¤äº’ç‚¹å‡»éŸ³æ•ˆ
    const clickSynth = new Tone.MembraneSynth({
      pitchDecay: 0.01,
      octaves: 2,
      envelope: {
        attack: 0.001,
        decay: 0.2,
        sustain: 0,
      }
    }).toDestination();

    // åˆ›å»ºèƒŒæ™¯éŸ³ä¹åˆæˆå™¨å’Œæ•ˆæœå™¨
    const ambientSynth = new Tone.FMSynth({
      harmonicity: 1.5,
      modulationIndex: 10,
      envelope: {
        attack: 0.2,
        decay: 1,
      },
    }).toDestination();
    const reverb = new Tone.Reverb(8).toDestination();
    ambientSynth.connect(reverb);
    
    // èƒŒæ™¯éŸ³ä¹çš„éŸ³ç¬¦åºåˆ—
    const notes = ['C2', 'G2', 'Eb3', 'Bb2'];
    let noteIndex = 0;

    // èƒŒæ™¯éŸ³ä¹å¾ªç¯æ’­æ”¾é€»è¾‘
    const ambientLoop = new Tone.Loop(time => {
      const note = notes[noteIndex % notes.length];
      ambientSynth.triggerAttackRelease(note, '2n', time);
      noteIndex++;
    }, '4n').start(0); // 4nä»£è¡¨å››åˆ†éŸ³ç¬¦ï¼Œå³æ¯ä¸ªèŠ‚æ‹è§¦å‘ä¸€æ¬¡

    // ç»‘å®šäº¤äº’ç‚¹å‡»éŸ³æ•ˆ
    interactiveLinks.forEach(link => {
      link.addEventListener('click', () => {
        if (!isMuted) {
          clickSynth.triggerAttackRelease('C1', '8n');
        }
      });
    });

    // å£°éŸ³æ€»å¼€å…³é€»è¾‘
    soundToggle.addEventListener('click', async () => {
      if (!isAudioReady) {
        await Tone.start();
        console.log('Audio is ready');
        isAudioReady = true;
        Tone.Transport.start(); // å¯åŠ¨Tone.jsçš„å…¨å±€æ—¶é’Ÿ
      }

      if (isMuted) {
        Tone.Destination.mute = false;
        soundToggle.textContent = 'ğŸ”Š';
        soundToggle.title = 'é™éŸ³';
      } else {
        Tone.Destination.mute = true;
        soundToggle.textContent = 'ğŸ”‡';
        soundToggle.title = 'å¼€å¯å£°éŸ³';
      }
      isMuted = !isMuted;
    });
  });
</script>

<style>
  /* æ­¥éª¤å››ï¼šä¸ºæ–°å…ƒç´ æ·»åŠ æ ·å¼ */
  .sound-control {
    position: fixed;
    bottom: 20px;
    left: 30px;
    font-size: 1.5rem;
    cursor: pointer;
    opacity: 0.5;
    transition: all 0.3s ease;
    z-index: 20;
  }
  .sound-control:hover {
    opacity: 1;
    transform: scale(1.2);
  }
  
  /* ä¸ºæ‰€æœ‰äº¤äº’é“¾æ¥æ·»åŠ ä¸€ä¸ªé€šç”¨ç±»åï¼Œæ–¹ä¾¿JSé€‰æ‹© */
  .interaction-point, .main-rune {
    /* è¿™é‡Œå¯ä»¥æ·»åŠ é€šç”¨äº¤äº’æ ·å¼ï¼Œå¦‚æœéœ€è¦çš„è¯ */
  }
</style>